<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>å®æ—¶èŠå¤©åº”ç”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ç™»å½•ç•Œé¢ */
        #login-screen {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 420px;
            width: 90%;
            animation: fadeIn 0.5s ease;
        }

        #login-screen h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 40px;
            font-size: 32px;
            font-weight: 700;
        }

        #login-screen input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            background: #fafafa;
        }

        #login-screen input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        #login-screen button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        #login-screen button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        #login-screen button:active {
            transform: translateY(0);
        }

        #error-msg {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
            min-height: 20px;
        }

        /* èŠå¤©ç•Œé¢ */
        #chat-screen {
            display: none;
            width: 100%;
            height: 100vh;
            background: #f5f7fa;
        }

        .chat-container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        /* ä¾§è¾¹æ  - é€šè®¯å½• */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e8eaed;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 24px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h2 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .create-group-btn {
            margin-top: 12px;
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .create-group-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }

        .contacts-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .contacts-list::-webkit-scrollbar {
            width: 6px;
        }

        .contacts-list::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 3px;
        }

        .contact-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }

        .contact-item:hover {
            background: #f8f9fa;
        }

        .contact-item.active {
            background: linear-gradient(90deg, #f0f2ff 0%, #faf5ff 100%);
            border-left-color: #667eea;
        }

        .contact-item .name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }

        .contact-item .status {
            font-size: 12px;
            color: #999;
        }

        .contact-item.active .status {
            color: #667eea;
        }

        .online-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .unread-badge {
            display: inline-block;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            line-height: 20px;
            text-align: center;
            border-radius: 10px;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(255,107,107,0.3);
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fafbfc;
        }

        .chat-header {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .chat-header h3 {
            font-size: 18px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #fafbfc;
        }

        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 4px;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: messageSlideIn 0.3s ease;
            width: 100%;
        }

        .message.sent {
            justify-content: flex-end !important;
            align-items: flex-end;
        }

        .message.sent .message-content {
            margin-left: auto !important;
            margin-right: 0;
        }

        .message.recall-notice {
            justify-content: center;
            margin: 10px 0;
        }

        .message.recall-notice .message-content {
            background: transparent;
            box-shadow: none;
            padding: 8px 0;
            text-align: center;
            max-width: 100%;
        }

        .message-content {
            max-width: 60%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
            word-wrap: break-word;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.received .message-content {
            background: white;
            color: #1a1a1a;
            border: 1px solid #e8eaed;
        }

        .message.sent .message-content.read {
            opacity: 0.85;
        }

        .message-content img {
            max-width: 100%;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s;
            display: block;
        }

        .message-content img:hover {
            transform: scale(1.02);
        }

        .message-time {
            font-size: 11px;
            margin-top: 6px;
            opacity: 0.7;
            color: #999;
        }

        .message.sent .message-time {
            text-align: right;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            padding: 20px 24px;
            background: white;
            border-top: 1px solid #e8eaed;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-area input[type="text"] {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e8eaed;
            border-radius: 24px;
            font-size: 15px;
            transition: all 0.2s;
            background: #fafbfc;
        }

        .input-area input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .input-area button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-area .image-btn {
            background: #f3f4f6;
            color: #667eea;
        }

        .input-area .image-btn:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .input-area .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .input-area .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .input-area input[type="file"] {
            display: none;
        }

        .input-area label {
            padding: 12px;
            background: #f3f4f6;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .input-area label:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
        }

        .empty-state svg {
            margin-bottom: 24px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #666;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* ç¾¤ç»„æ ‡è¯† */
        .group-indicator {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 11px;
            border-radius: 4px;
            margin-right: 8px;
            font-weight: 600;
        }

        /* åˆ›å»ºç¾¤ç»„å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .close-btn {
            background: #f3f4f6;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #e5e7eb;
            transform: rotate(90deg);
        }

        .modal-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e8eaed;
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .modal-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .member-list {
            margin-bottom: 20px;
        }

        .member-item {
            padding: 14px 16px;
            border: 2px solid #e8eaed;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .member-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .member-item input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .modal-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .modal-btn.secondary {
            background: #f3f4f6;
            color: #666;
        }

        .modal-btn.secondary:hover {
            background: #e5e7eb;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è¯­éŸ³å½•åˆ¶ç•Œé¢ */
        .voice-recorder {
            display: none;
            padding: 20px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-top: 1px solid rgba(255,255,255,0.2);
            align-items: center;
            gap: 16px;
        }

        .voice-recorder.active {
            display: flex;
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            flex: 1;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .recording-time {
            font-size: 18px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .recording-actions {
            display: flex;
            gap: 12px;
        }

        .recording-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-recording-btn {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .cancel-recording-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .stop-recording-btn {
            background: white;
            color: #667eea;
        }

        .stop-recording-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* è¯­éŸ³é¢„è§ˆç•Œé¢ */
        .voice-preview {
            display: none;
            padding: 20px 24px;
            background: #f8f9fa;
            border-top: 1px solid #e8eaed;
            align-items: center;
            gap: 16px;
        }

        .voice-preview.active {
            display: flex;
        }

        .voice-waveform {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .play-voice-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .play-voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .voice-duration {
            font-size: 14px;
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .voice-preview-actions {
            display: flex;
            gap: 12px;
        }

        .voice-preview-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rerecord-btn {
            background: #f3f4f6;
            color: #666;
        }

        .rerecord-btn:hover {
            background: #e5e7eb;
        }

        .send-voice-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .send-voice-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        /* è¯­éŸ³æ¶ˆæ¯æ°”æ³¡ */
        .voice-message {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
        }

        .voice-play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.3);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .message.received .voice-play-btn {
            background: #667eea;
            color: white;
        }

        .voice-play-btn:hover {
            transform: scale(1.1);
        }

        .voice-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .voice-duration-text {
            font-size: 13px;
            opacity: 0.9;
        }

        .voice-playing-animation {
            display: flex;
            gap: 2px;
            align-items: center;
            height: 20px;
        }

        .voice-bar {
            width: 3px;
            background: currentColor;
            border-radius: 2px;
            animation: voiceWave 1s ease-in-out infinite;
        }

        .voice-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .voice-bar:nth-child(2) { height: 14px; animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { height: 10px; animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { height: 16px; animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { height: 12px; animation-delay: 0.4s; }

        @keyframes voiceWave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }

        /* å“åº”å¼è®¾è®¡ */
        /* iPhone ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                align-items: stretch;
                padding: 0;
            }

            #login-screen {
                width: 100%;
                height: 100vh;
                max-width: none;
                border-radius: 0;
                padding: 60px 30px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            #login-screen h1 {
                font-size: 32px;
                margin-bottom: 40px;
            }

            #nickname-input {
                font-size: 16px;
                padding: 16px;
                height: auto;
            }

            #login-btn {
                font-size: 16px;
                padding: 16px;
                height: auto;
            }

            #chat-screen {
                width: 100%;
                height: 100vh;
            }

            .chat-container {
                width: 100%;
                height: 100vh;
                max-width: none;
                border-radius: 0;
                flex-direction: column;
                position: relative;
            }

            /* ä¾§è¾¹æ å˜ä¸ºå…¨å±å¯æ»‘å‡º */
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            }

            .sidebar.active {
                left: 0;
            }

            /* é®ç½©å±‚ */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }

            .sidebar-overlay.active {
                display: block;
            }

            .chat-area {
                flex: 1;
                width: 100%;
                border-radius: 0;
                display: flex;
                flex-direction: column;
            }

            .chat-header {
                padding: 12px 16px;
                min-height: 56px;
                flex-direction: row;
                align-items: center;
            }

            .chat-header h3 {
                font-size: 17px;
                flex: 1;
            }

            /* æ·»åŠ èœå•æŒ‰é’®ï¼ˆæ±‰å ¡å›¾æ ‡ï¼‰ */
            .menu-btn {
                display: inline-flex !important;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                border: none;
                background: rgba(255,255,255,0.2);
                color: white;
                border-radius: 8px;
                cursor: pointer;
                margin-right: 12px;
                padding: 0;
                flex-shrink: 0;
            }

            .menu-btn svg {
                width: 22px;
                height: 22px;
            }

            #ai-summary-btn, #bot-settings-btn {
                font-size: 13px !important;
                padding: 6px 12px !important;
            }

            .messages-container {
                padding: 12px;
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .message {
                margin-bottom: 16px;
            }

            .message-content {
                max-width: 80%;
                font-size: 15px;
                padding: 10px 14px;
            }

            .message-sender {
                font-size: 13px !important;
            }

            .message-time {
                font-size: 11px;
            }

            .input-area {
                padding: 10px 12px;
                gap: 8px;
                border-radius: 0;
                /* é€‚é…iPhoneåº•éƒ¨å®‰å…¨åŒºåŸŸ */
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }

            #message-input {
                font-size: 16px;
                padding: 10px 14px;
                border-radius: 20px;
            }

            .image-btn, .send-btn {
                width: 36px;
                height: 36px;
                min-width: 36px;
            }

            .voice-recorder, .voice-preview {
                padding: 20px;
                border-radius: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }

            /* è¯­éŸ³æ¶ˆæ¯é€‚é… */
            .voice-message {
                min-width: 150px;
            }

            .voice-play-btn {
                width: 36px;
                height: 36px;
            }

            /* è”ç³»äººåˆ—è¡¨ */
            .contact-item, .group-item {
                padding: 14px 16px;
            }

            .contact-name {
                font-size: 16px;
            }

            .unread-badge {
                min-width: 20px;
                height: 20px;
                font-size: 11px;
            }

            /* åˆ›å»ºç¾¤èŠæŒ‰é’® */
            .create-group-btn {
                font-size: 14px;
                padding: 10px 16px;
            }

            /* æ¨¡æ€æ¡†é€‚é… */
            .modal {
                padding: 20px;
            }

            .modal-content {
                width: 90%;
                max-width: none;
                border-radius: 16px;
                max-height: 80vh;
            }

            .modal-content h2 {
                font-size: 20px;
            }

            /* å¼•ç”¨é¢„è§ˆé€‚é… */
            #quote-preview {
                padding: 8px 12px;
                margin: 0 12px;
            }

            /* ç©ºçŠ¶æ€ */
            .empty-state {
                padding: 40px 20px;
            }

            .empty-state svg {
                width: 48px;
                height: 48px;
            }

            .empty-state h3 {
                font-size: 18px;
            }

            .empty-state p {
                font-size: 14px;
            }

            /* ç¦ç”¨æ–‡æœ¬é€‰æ‹©ï¼ˆæ›´åƒåŸç”Ÿappï¼‰ */
            .chat-header, .sidebar-header, .contact-item, .group-item {
                -webkit-user-select: none;
                user-select: none;
            }

            /* æ»šåŠ¨æ¡éšè— */
            .messages-container::-webkit-scrollbar,
            .contacts-list::-webkit-scrollbar {
                display: none;
            }

            /* è§¦æ‘¸åé¦ˆ */
            .contact-item:active, .group-item:active,
            .send-btn:active, .image-btn:active,
            .create-group-btn:active, .menu-btn:active {
                opacity: 0.7;
            }
        }

        /* iPhone X åŠæ›´æ–°æœºå‹çš„å®‰å…¨åŒºåŸŸé€‚é… */
        @supports (padding: max(0px)) {
            @media (max-width: 768px) {
                body {
                    padding-top: env(safe-area-inset-top);
                }

                .chat-header {
                    padding-top: max(12px, env(safe-area-inset-top));
                }

                .sidebar {
                    padding-top: env(safe-area-inset-top);
                }
            }
        }
    </style>
    <!-- PDF.js åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-screen">
        <h1>ğŸ’¬ å®æ—¶èŠå¤©</h1>
        <input type="text" id="nickname-input" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°" maxlength="20">
        <button id="login-btn">è¿›å…¥èŠå¤©</button>
        <div id="error-msg"></div>
    </div>

    <!-- èŠå¤©ç•Œé¢ -->
    <div id="chat-screen">
        <div class="chat-container">
            <!-- ä¾§è¾¹æ é®ç½©å±‚ (ä»…ç§»åŠ¨ç«¯) -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2 id="current-user-name">ç”¨æˆ·</h2>
                    <p>åœ¨çº¿ç”¨æˆ·</p>
                    <button class="create-group-btn" id="create-group-btn">+ åˆ›å»ºç¾¤èŠ</button>
                    <button class="create-group-btn" id="logout-btn" style="margin-top: 10px; background: rgba(255,255,255,0.15);">åˆ‡æ¢ç”¨æˆ·</button>
                </div>
                <div class="contacts-list" id="contacts-list">
                    <!-- é€šè®¯å½•å°†åŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-area">
                <div class="chat-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <button class="menu-btn" id="menu-btn" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <h3 id="chat-with-name">é€‰æ‹©ä¸€ä¸ªè”ç³»äººå¼€å§‹èŠå¤©</h3>
                    <div style="display: flex; gap: 10px;">
                        <button id="ai-summary-btn" style="padding: 8px 16px; background: #07c160; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">ğŸ¤– AIèŠå¤©æ€»ç»“</button>
                        <button id="bot-settings-btn" style="display: none; padding: 8px 16px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">âš™ï¸ è®¾ç½®Prompt</button>
                    </div>
                </div>
                <div class="messages-container" id="messages-container">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h3>å¼€å§‹èŠå¤©</h3>
                        <p>ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªè”ç³»äººå¼€å§‹å¯¹è¯</p>
                    </div>
                </div>
                <!-- å¼•ç”¨æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
                <div id="quote-preview" style="display: none; padding: 8px 16px; background: rgba(0,0,0,0.05); border-left: 3px solid #6c5ce7; margin: 0 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 12px; color: #6c5ce7; font-weight: 500;">å›å¤ <span id="quote-user"></span></div>
                            <div id="quote-content" style="font-size: 13px; color: #666; margin-top: 2px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
                        </div>
                        <button id="cancel-quote" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0 8px;">Ã—</button>
                    </div>
                </div>
                <!-- æ™®é€šè¾“å…¥åŒºåŸŸ (éæœºå™¨äººèŠå¤©) -->
                <div class="input-area" id="input-area">
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                    <button class="image-btn" onclick="document.getElementById('image-input').click()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </button>
                    <button class="image-btn" id="voice-btn" title="è¯­éŸ³æ¶ˆæ¯">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <input type="text" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button class="send-btn" id="send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
                <!-- è¯­éŸ³å½•åˆ¶ç•Œé¢ -->
                <div class="voice-recorder" id="voice-recorder">
                    <div class="recording-indicator">
                        <div class="recording-dot"></div>
                        <div class="recording-time" id="recording-time">00:00</div>
                        <span style="color: white; font-size: 14px;">æ­£åœ¨å½•åˆ¶...</span>
                    </div>
                    <div class="recording-actions">
                        <button class="cancel-recording-btn" id="cancel-recording-btn">âŒ å–æ¶ˆ</button>
                        <button class="stop-recording-btn" id="stop-recording-btn">â¹ å®Œæˆå½•åˆ¶</button>
                    </div>
                </div>
                <!-- è¯­éŸ³é¢„è§ˆç•Œé¢ -->
                <div class="voice-preview" id="voice-preview">
                    <div class="voice-waveform">
                        <button class="play-voice-btn" id="play-preview-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </button>
                        <div class="voice-duration" id="preview-duration">00:00</div>
                    </div>
                    <div class="voice-preview-actions">
                        <button class="rerecord-btn" id="rerecord-btn">ğŸ”„ é‡æ–°å½•åˆ¶</button>
                        <button class="send-voice-btn" id="send-voice-btn">ğŸ“¤ å‘é€</button>
                    </div>
                </div>
                <!-- æœºå™¨äººè¾“å…¥åŒºåŸŸ (ä»…å¯¹æ€¡æ€»æ˜¾ç¤º) -->
                <div id="bot-input-area" style="display: none; padding: 16px; background: #f9f9f9; border-top: 2px solid #e0e0e0;">
                    <!-- ä¸Šæ–¹ï¼šè¾“å…¥åŒºåŸŸ -->
                    <div style="display: flex; gap: 16px; height: 200px; margin-bottom: 16px;">
                        <!-- å·¦ä¾§ï¼šæ–‡æœ¬è¾“å…¥åŒºåŸŸ -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="font-size: 13px; font-weight: 500; color: #666; margin-bottom: 8px;">ğŸ“‹ ç²˜è´´æˆ–è¾“å…¥èŠå¤©è®°å½•</div>
                            <textarea
                                id="bot-text-input"
                                placeholder="åœ¨è¿™é‡Œç²˜è´´æˆ–è¾“å…¥èŠå¤©è®°å½•...&#10;&#10;ä¾‹å¦‚ï¼š&#10;å¼ ä¸‰ 10:30&#10;å¤§å®¶å¥½ï¼Œä»Šå¤©è®¨è®ºé¡¹ç›®è¿›åº¦&#10;&#10;æå›› 10:32&#10;é¡¹ç›®è¿›å±•é¡ºåˆ©..."
                                style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Courier New', monospace; resize: none; line-height: 1.5;"
                            ></textarea>
                        </div>
                        <!-- å³ä¾§ï¼šPDFä¸Šä¼ åŒºåŸŸ -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="font-size: 13px; font-weight: 500; color: #666; margin-bottom: 8px;">ğŸ“„ ä¸Šä¼ PDFæ–‡ä»¶</div>
                            <div id="bot-pdf-drop-zone" style="flex: 1; border: 2px dashed #6c5ce7; border-radius: 8px; padding: 20px; text-align: center; background: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <input type="file" id="bot-pdf-input" accept=".pdf" style="display: none;">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2" style="margin-bottom: 12px;">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 4px;">æ‹–æ‹½PDFæ–‡ä»¶åˆ°è¿™é‡Œ</div>
                                <div style="font-size: 12px; color: #999;">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ (æœ€å¤§10MB)</div>
                            </div>
                            <div id="bot-pdf-file-info" style="display: none; flex: 1; padding: 10px; background: white; border: 2px solid #6c5ce7; border-radius: 8px; font-size: 13px;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="flex: 1; overflow: hidden;">
                                        <div id="bot-pdf-file-name" style="font-weight: 500; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                                        <div id="bot-pdf-file-size" style="font-size: 11px; color: #999; margin-top: 2px;"></div>
                                    </div>
                                    <button id="bot-remove-pdf-btn" style="background: none; border: none; font-size: 18px; color: #999; cursor: pointer; margin-left: 8px;">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- æ€»ç»“æŒ‰é’® -->
                    <button id="bot-submit-btn" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #6c5ce7 0%, #5f27cd 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-bottom: 16px;">ğŸ“Š å¼€å§‹æ€»ç»“</button>
                    <!-- ä¸‹æ–¹ï¼šæ€»ç»“ç»“æœå±•ç¤ºåŒºåŸŸ -->
                    <div id="bot-result-area" style="display: none; padding: 20px; background: white; border-radius: 8px; border-left: 4px solid #6c5ce7; min-height: 200px;">
                        <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 12px;">ğŸ“Š æ€»ç»“ç»“æœ</div>
                        <div id="bot-result-content" style="font-size: 14px; line-height: 1.8; color: #555; white-space: pre-wrap;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºç¾¤ç»„å¼¹çª— -->
    <div class="modal" id="create-group-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆ›å»ºç¾¤èŠ</h3>
                <button class="close-btn" id="close-modal-btn">&times;</button>
            </div>
            <input type="text" class="modal-input" id="group-name-input" placeholder="è¾“å…¥ç¾¤åç§°ï¼ˆæœ€å¤š20ä¸ªå­—ç¬¦ï¼‰" maxlength="20">
            <div class="member-list" id="member-list">
                <!-- æˆå‘˜åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancel-group-btn">å–æ¶ˆ</button>
                <button class="modal-btn primary" id="confirm-group-btn">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- é˜…è¯»è¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="read-detail-modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>é˜…è¯»çŠ¶æ€</h3>
                <button class="close-btn" id="close-read-detail-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">å·²è¯» (<span id="read-count">0</span>)</div>
                <div id="read-list" style="max-height: 150px; overflow-y: auto; margin-bottom: 16px;">
                    <!-- å·²è¯»æˆå‘˜åˆ—è¡¨ -->
                </div>
                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">æœªè¯» (<span id="unread-count">0</span>)</div>
                <div id="unread-list" style="max-height: 150px; overflow-y: auto;">
                    <!-- æœªè¯»æˆå‘˜åˆ—è¡¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æœºå™¨äººPromptè®¾ç½®å¼¹çª— -->
    <div class="modal" id="bot-settings-modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>âš™ï¸ è®¾ç½®æ€»ç»“Prompt</h3>
                <button class="close-btn" id="close-bot-settings-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                    è‡ªå®šä¹‰Promptï¼š
                </label>
                <textarea
                    id="bot-prompt-input"
                    placeholder="ä¾‹å¦‚ï¼šè¯·ç”¨3ä¸ªè¦ç‚¹æ€»ç»“ä¼šè®®å†…å®¹ï¼Œçªå‡ºè¡ŒåŠ¨é¡¹å’Œè´£ä»»äºº"
                    style="width: 100%; height: 150px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical;"
                ></textarea>
                <div style="margin-top: 12px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 13px; color: #666;">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>è¿™ä¸ªPromptå°†ç”¨äºæ€»ç»“ä½ å‘é€çš„èŠå¤©è®°å½•ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ€»ç»“çš„æ ¼å¼å’Œé‡ç‚¹ã€‚
                </div>
                <div style="margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-bot-settings-btn" style="padding: 10px 20px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
                    <button id="save-bot-settings-btn" style="padding: 10px 20px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- èŠå¤©è®°å½•ç²˜è´´/PDFä¸Šä¼ å¼¹çª— -->
    <div class="modal" id="bot-upload-modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>ğŸ“‹ æäº¤èŠå¤©è®°å½•</h3>
                <button class="close-btn" id="close-bot-upload-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <!-- Tabåˆ‡æ¢ -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button id="paste-tab" class="upload-tab active" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid #6c5ce7; color: #6c5ce7; font-size: 15px; font-weight: 500; cursor: pointer;">ç²˜è´´æ–‡æœ¬</button>
                    <button id="upload-tab" class="upload-tab" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid transparent; color: #999; font-size: 15px; font-weight: 500; cursor: pointer;">ä¸Šä¼ PDF</button>
                </div>

                <!-- ç²˜è´´æ–‡æœ¬åŒºåŸŸ -->
                <div id="paste-content" style="display: block;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        ç²˜è´´èŠå¤©è®°å½•ï¼š
                    </label>
                    <textarea
                        id="chat-record-input"
                        placeholder="å°†èŠå¤©è®°å½•ç²˜è´´åˆ°è¿™é‡Œ...&#10;&#10;ä¾‹å¦‚ï¼š&#10;å¼ ä¸‰ 10:30&#10;å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬è®¨è®ºé¡¹ç›®è¿›åº¦&#10;&#10;æå›› 10:32&#10;é¡¹ç›®ç›®å‰è¿›å±•é¡ºåˆ©..."
                        style="width: 100%; height: 300px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Courier New', monospace; resize: vertical; line-height: 1.5;"
                    ></textarea>
                    <div style="margin-top: 12px; padding: 12px; background: #f0f7ff; border-left: 4px solid #6c5ce7; border-radius: 4px; font-size: 13px; color: #555;">
                        ğŸ’¡ <strong>æç¤ºï¼š</strong>ç›´æ¥ç²˜è´´èŠå¤©è®°å½•æ–‡æœ¬ï¼Œæ€¡æ€»ä¼šæ ¹æ®ä½ è®¾ç½®çš„Promptè¿›è¡Œæ€»ç»“åˆ†æã€‚
                    </div>
                </div>

                <!-- ä¸Šä¼ PDFåŒºåŸŸ -->
                <div id="upload-content" style="display: none;">
                    <div style="border: 2px dashed #6c5ce7; border-radius: 12px; padding: 40px; text-align: center; background: #f9f9ff; cursor: pointer;" id="pdf-drop-zone">
                        <input type="file" id="pdf-input" accept=".pdf" style="display: none;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2" style="margin: 0 auto 16px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        <div style="font-size: 16px; font-weight: 500; color: #333; margin-bottom: 8px;">ç‚¹å‡»æˆ–æ‹–æ‹½PDFæ–‡ä»¶åˆ°è¿™é‡Œ</div>
                        <div style="font-size: 13px; color: #999;">æ”¯æŒPDFæ ¼å¼ï¼Œæœ€å¤§10MB</div>
                    </div>
                    <div id="pdf-file-info" style="display: none; margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 14px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <div style="flex: 1;">
                                <div id="pdf-file-name" style="font-weight: 500; color: #333;"></div>
                                <div id="pdf-file-size" style="font-size: 12px; color: #999; margin-top: 2px;"></div>
                            </div>
                            <button id="remove-pdf-btn" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer;">Ã—</button>
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px; font-size: 13px; color: #856404;">
                        âš ï¸ <strong>æ³¨æ„ï¼š</strong>PDFæ–‡æœ¬æå–åŠŸèƒ½éœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼Œå½“å‰ç‰ˆæœ¬ä¼šæå–PDFä¸­çš„æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ†æã€‚
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-bot-upload-btn" style="padding: 10px 24px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
                    <button id="submit-bot-upload-btn" style="padding: 10px 24px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">ğŸ“¤ æäº¤æ€»ç»“</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AIèŠå¤©æ€»ç»“å¯¹è¯æ¡† -->
    <div class="modal" id="ai-summary-modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>ğŸ¤– AIèŠå¤©æ€»ç»“</h3>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button id="config-summary-prompt-btn" style="padding: 6px 12px; background: #6c5ce7; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">âš™ï¸ é…ç½®Prompt</button>
                    <button class="close-btn" id="close-ai-summary-btn">&times;</button>
                </div>
            </div>
            <div style="margin-top: 16px;">
                <!-- Prompté…ç½®åŒºåŸŸï¼ˆé»˜è®¤éšè—ï¼‰ -->
                <div id="summary-prompt-config" style="display: none; margin-bottom: 20px; padding: 12px; background: #f9f9ff; border: 2px solid #6c5ce7; border-radius: 8px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px;">
                        æ€»ç»“Promptï¼š
                    </label>
                    <textarea id="summary-prompt-input" placeholder="è¯·è¾“å…¥ä½ å¸Œæœ›AIå¦‚ä½•æ€»ç»“èŠå¤©è®°å½•çš„æç¤ºè¯..." style="width: 100%; height: 150px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 13px; font-family: 'Courier New', monospace; resize: vertical; line-height: 1.5;"></textarea>
                    <div style="margin-top: 8px; font-size: 12px; color: #666;">
                        ğŸ’¡ æç¤ºï¼šç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤çš„å¤šç»´åº¦åˆ†ææç¤ºè¯
                    </div>
                </div>

                <!-- ç”¨æˆ·é€‰æ‹© -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        é€‰æ‹©ç”¨æˆ·ï¼š
                    </label>
                    <div id="user-select-container" style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 12px; max-height: 200px; overflow-y: auto; background: #fafafa;">
                        <!-- ç”¨æˆ·å¤é€‰æ¡†åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æ—¶é—´æ®µé€‰æ‹© -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        æ—¶é—´æ®µï¼š
                    </label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="date" id="summary-start-date" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        <span style="color: #999;">è‡³</span>
                        <input type="date" id="summary-end-date" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-ai-summary-btn" style="padding: 10px 24px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
                    <button id="submit-ai-summary-btn" style="padding: 10px 24px; background: #07c160; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">ğŸ“Š å¼€å§‹æ€»ç»“</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AIæ€»ç»“ç»“æœæŠ½å±‰ -->
    <div id="ai-summary-drawer" style="display: none; position: fixed; right: 0; top: 0; width: 500px; height: 100vh; background: white; box-shadow: -4px 0 24px rgba(0,0,0,0.15); z-index: 10000; overflow-y: auto;">
        <div style="padding: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 16px;">
                <h3 style="font-size: 20px; color: #333;">ğŸ“Š AIèŠå¤©æ€»ç»“ç»“æœ</h3>
                <button id="close-drawer-btn" style="background: none; border: none; font-size: 28px; color: #999; cursor: pointer; line-height: 1;">&times;</button>
            </div>

            <!-- æ€»ç»“ä¿¡æ¯ -->
            <div id="summary-info" style="margin-bottom: 20px; padding: 12px; background: #f0f7ff; border-left: 4px solid #07c160; border-radius: 4px;">
                <div style="font-size: 13px; color: #666; line-height: 1.6;">
                    <div><strong>ç”¨æˆ·ï¼š</strong><span id="summary-users-info"></span></div>
                    <div><strong>æ—¶é—´æ®µï¼š</strong><span id="summary-time-info"></span></div>
                    <div><strong>æ¶ˆæ¯æ•°é‡ï¼š</strong><span id="summary-count-info"></span></div>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="summary-loading" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
                <div style="font-size: 16px; color: #666;">AIæ­£åœ¨åˆ†æèŠå¤©è®°å½•...</div>
            </div>

            <!-- æ€»ç»“å†…å®¹ -->
            <div id="summary-result-content" style="font-size: 14px; line-height: 1.8; color: #333; white-space: pre-wrap;"></div>
        </div>
    </div>

    <!-- æŠ½å±‰é®ç½©å±‚ -->
    <div id="drawer-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;"></div>

    <script src="app.js"></script>
</body>
</html>
