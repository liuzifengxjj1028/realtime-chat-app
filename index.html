<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>实时聊天应用</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 登录界面 */
        #login-screen {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 420px;
            width: 90%;
            animation: fadeIn 0.5s ease;
        }

        #login-screen h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 40px;
            font-size: 32px;
            font-weight: 700;
        }

        #login-screen input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            background: #fafafa;
        }

        #login-screen input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        #login-screen button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        #login-screen button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        #login-screen button:active {
            transform: translateY(0);
        }

        #error-msg {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
            min-height: 20px;
        }

        /* 聊天界面 */
        #chat-screen {
            display: none;
            width: 100%;
            height: 100vh;
            background: #f5f7fa;
        }

        .chat-container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        /* 侧边栏 - 通讯录 */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e8eaed;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 24px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h2 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .create-group-btn {
            margin-top: 12px;
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .create-group-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }

        .contacts-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .contacts-list::-webkit-scrollbar {
            width: 6px;
        }

        .contacts-list::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 3px;
        }

        .contact-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }

        .contact-item:hover {
            background: #f8f9fa;
        }

        .contact-item.active {
            background: linear-gradient(90deg, #f0f2ff 0%, #faf5ff 100%);
            border-left-color: #667eea;
        }

        .contact-item .name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }

        .contact-item .status {
            font-size: 12px;
            color: #999;
        }

        .contact-item.active .status {
            color: #667eea;
        }

        .online-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .unread-badge {
            display: inline-block;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            line-height: 20px;
            text-align: center;
            border-radius: 10px;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(255,107,107,0.3);
        }

        /* 聊天区域 */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fafbfc;
        }

        .chat-header {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .chat-header h3 {
            font-size: 18px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #fafbfc;
        }

        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 4px;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: messageSlideIn 0.3s ease;
            width: 100%;
        }

        .message.sent {
            justify-content: flex-end !important;
            align-items: flex-end;
        }

        .message.sent .message-content {
            margin-left: auto !important;
            margin-right: 0;
        }

        .message.recall-notice {
            justify-content: center;
            margin: 10px 0;
        }

        .message.recall-notice .message-content {
            background: transparent;
            box-shadow: none;
            padding: 8px 0;
            text-align: center;
            max-width: 100%;
        }

        .message-content {
            max-width: 60%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
            word-wrap: break-word;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.received .message-content {
            background: white;
            color: #1a1a1a;
            border: 1px solid #e8eaed;
        }

        .message.sent .message-content.read {
            opacity: 0.85;
        }

        .message-content img {
            max-width: 100%;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s;
            display: block;
        }

        .message-content img:hover {
            transform: scale(1.02);
        }

        .message-time {
            font-size: 11px;
            margin-top: 6px;
            opacity: 0.7;
            color: #999;
        }

        .message.sent .message-time {
            text-align: right;
        }

        /* 输入区域 */
        .input-area {
            padding: 20px 24px;
            background: white;
            border-top: 1px solid #e8eaed;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-area input[type="text"] {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e8eaed;
            border-radius: 24px;
            font-size: 15px;
            transition: all 0.2s;
            background: #fafbfc;
        }

        .input-area input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .input-area button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-area .image-btn {
            background: #f3f4f6;
            color: #667eea;
        }

        .input-area .image-btn:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .input-area .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .input-area .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .input-area input[type="file"] {
            display: none;
        }

        .input-area label {
            padding: 12px;
            background: #f3f4f6;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .input-area label:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
        }

        .empty-state svg {
            margin-bottom: 24px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #666;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* 群组标识 */
        .group-indicator {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 11px;
            border-radius: 4px;
            margin-right: 8px;
            font-weight: 600;
        }

        /* 创建群组弹窗 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .close-btn {
            background: #f3f4f6;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #e5e7eb;
            transform: rotate(90deg);
        }

        .modal-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e8eaed;
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .modal-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .member-list {
            margin-bottom: 20px;
        }

        .member-item {
            padding: 14px 16px;
            border: 2px solid #e8eaed;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .member-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .member-item input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .modal-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .modal-btn.secondary {
            background: #f3f4f6;
            color: #666;
        }

        .modal-btn.secondary:hover {
            background: #e5e7eb;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 语音录制界面 */
        .voice-recorder {
            display: none;
            padding: 20px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-top: 1px solid rgba(255,255,255,0.2);
            align-items: center;
            gap: 16px;
        }

        .voice-recorder.active {
            display: flex;
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            flex: 1;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .recording-time {
            font-size: 18px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .recording-actions {
            display: flex;
            gap: 12px;
        }

        .recording-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-recording-btn {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .cancel-recording-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .stop-recording-btn {
            background: white;
            color: #667eea;
        }

        .stop-recording-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* 语音预览界面 */
        .voice-preview {
            display: none;
            padding: 20px 24px;
            background: #f8f9fa;
            border-top: 1px solid #e8eaed;
            align-items: center;
            gap: 16px;
        }

        .voice-preview.active {
            display: flex;
        }

        .voice-waveform {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .play-voice-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .play-voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .voice-duration {
            font-size: 14px;
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .voice-preview-actions {
            display: flex;
            gap: 12px;
        }

        .voice-preview-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rerecord-btn {
            background: #f3f4f6;
            color: #666;
        }

        .rerecord-btn:hover {
            background: #e5e7eb;
        }

        .send-voice-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }

        .send-voice-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        /* 语音消息气泡 */
        .voice-message {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
        }

        .voice-play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.3);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .message.received .voice-play-btn {
            background: #667eea;
            color: white;
        }

        .voice-play-btn:hover {
            transform: scale(1.1);
        }

        .voice-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .voice-duration-text {
            font-size: 13px;
            opacity: 0.9;
        }

        .voice-playing-animation {
            display: flex;
            gap: 2px;
            align-items: center;
            height: 20px;
        }

        .voice-bar {
            width: 3px;
            background: currentColor;
            border-radius: 2px;
            animation: voiceWave 1s ease-in-out infinite;
        }

        .voice-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .voice-bar:nth-child(2) { height: 14px; animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { height: 10px; animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { height: 16px; animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { height: 12px; animation-delay: 0.4s; }

        @keyframes voiceWave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }

        /* 响应式设计 */
        /* iPhone 移动端适配 */
        @media (max-width: 768px) {
            body {
                align-items: stretch;
                padding: 0;
            }

            #login-screen {
                width: 100%;
                height: 100vh;
                max-width: none;
                border-radius: 0;
                padding: 60px 30px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            #login-screen h1 {
                font-size: 32px;
                margin-bottom: 40px;
            }

            #nickname-input {
                font-size: 16px;
                padding: 16px;
                height: auto;
            }

            #login-btn {
                font-size: 16px;
                padding: 16px;
                height: auto;
            }

            #chat-screen {
                width: 100%;
                height: 100vh;
            }

            .chat-container {
                width: 100%;
                height: 100vh;
                max-width: none;
                border-radius: 0;
                flex-direction: column;
                position: relative;
            }

            /* 侧边栏变为全屏可滑出 */
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            }

            .sidebar.active {
                left: 0;
            }

            /* 遮罩层 */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }

            .sidebar-overlay.active {
                display: block;
            }

            .chat-area {
                flex: 1;
                width: 100%;
                border-radius: 0;
                display: flex;
                flex-direction: column;
            }

            .chat-header {
                padding: 12px 16px;
                min-height: 56px;
                flex-direction: row;
                align-items: center;
            }

            .chat-header h3 {
                font-size: 17px;
                flex: 1;
            }

            /* 添加菜单按钮（汉堡图标） */
            .menu-btn {
                display: inline-flex !important;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                border: none;
                background: rgba(255,255,255,0.2);
                color: white;
                border-radius: 8px;
                cursor: pointer;
                margin-right: 12px;
                padding: 0;
                flex-shrink: 0;
            }

            .menu-btn svg {
                width: 22px;
                height: 22px;
            }

            #ai-summary-btn, #bot-settings-btn {
                font-size: 13px !important;
                padding: 6px 12px !important;
            }

            .messages-container {
                padding: 12px;
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .message {
                margin-bottom: 16px;
            }

            .message-content {
                max-width: 80%;
                font-size: 15px;
                padding: 10px 14px;
            }

            .message-sender {
                font-size: 13px !important;
            }

            .message-time {
                font-size: 11px;
            }

            .input-area {
                padding: 10px 12px;
                gap: 8px;
                border-radius: 0;
                /* 适配iPhone底部安全区域 */
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }

            #message-input {
                font-size: 16px;
                padding: 10px 14px;
                border-radius: 20px;
            }

            .image-btn, .send-btn {
                width: 36px;
                height: 36px;
                min-width: 36px;
            }

            .voice-recorder, .voice-preview {
                padding: 20px;
                border-radius: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }

            /* 语音消息适配 */
            .voice-message {
                min-width: 150px;
            }

            .voice-play-btn {
                width: 36px;
                height: 36px;
            }

            /* 联系人列表 */
            .contact-item, .group-item {
                padding: 14px 16px;
            }

            .contact-name {
                font-size: 16px;
            }

            .unread-badge {
                min-width: 20px;
                height: 20px;
                font-size: 11px;
            }

            /* 创建群聊按钮 */
            .create-group-btn {
                font-size: 14px;
                padding: 10px 16px;
            }

            /* 模态框适配 */
            .modal {
                padding: 20px;
            }

            .modal-content {
                width: 90%;
                max-width: none;
                border-radius: 16px;
                max-height: 80vh;
            }

            .modal-content h2 {
                font-size: 20px;
            }

            /* 引用预览适配 */
            #quote-preview {
                padding: 8px 12px;
                margin: 0 12px;
            }

            /* 空状态 */
            .empty-state {
                padding: 40px 20px;
            }

            .empty-state svg {
                width: 48px;
                height: 48px;
            }

            .empty-state h3 {
                font-size: 18px;
            }

            .empty-state p {
                font-size: 14px;
            }

            /* 禁用文本选择（更像原生app） */
            .chat-header, .sidebar-header, .contact-item, .group-item {
                -webkit-user-select: none;
                user-select: none;
            }

            /* 滚动条隐藏 */
            .messages-container::-webkit-scrollbar,
            .contacts-list::-webkit-scrollbar {
                display: none;
            }

            /* 触摸反馈 */
            .contact-item:active, .group-item:active,
            .send-btn:active, .image-btn:active,
            .create-group-btn:active, .menu-btn:active {
                opacity: 0.7;
            }
        }

        /* iPhone X 及更新机型的安全区域适配 */
        @supports (padding: max(0px)) {
            @media (max-width: 768px) {
                body {
                    padding-top: env(safe-area-inset-top);
                }

                .chat-header {
                    padding-top: max(12px, env(safe-area-inset-top));
                }

                .sidebar {
                    padding-top: env(safe-area-inset-top);
                }
            }
        }
    </style>
    <!-- PDF.js 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <!-- 登录界面 -->
    <div id="login-screen">
        <h1>💬 实时聊天</h1>
        <input type="text" id="nickname-input" placeholder="请输入你的昵称" maxlength="20">
        <button id="login-btn">进入聊天</button>
        <div id="error-msg"></div>
    </div>

    <!-- 聊天界面 -->
    <div id="chat-screen">
        <div class="chat-container">
            <!-- 侧边栏遮罩层 (仅移动端) -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <!-- 侧边栏 -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2 id="current-user-name">用户</h2>
                    <p>在线用户</p>
                    <button class="create-group-btn" id="create-group-btn">+ 创建群聊</button>
                    <button class="create-group-btn" id="logout-btn" style="margin-top: 10px; background: rgba(255,255,255,0.15);">切换用户</button>
                </div>
                <div class="contacts-list" id="contacts-list">
                    <!-- 通讯录将动态加载 -->
                </div>
            </div>

            <!-- 聊天区域 -->
            <div class="chat-area">
                <div class="chat-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <button class="menu-btn" id="menu-btn" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <h3 id="chat-with-name">选择一个联系人开始聊天</h3>
                    <div style="display: flex; gap: 10px;">
                        <button id="ai-summary-btn" style="padding: 8px 16px; background: #07c160; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">🤖 AI聊天总结</button>
                        <button id="bot-settings-btn" style="display: none; padding: 8px 16px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">⚙️ 设置Prompt</button>
                    </div>
                </div>
                <div class="messages-container" id="messages-container">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h3>开始聊天</h3>
                        <p>从左侧选择一个联系人开始对话</p>
                    </div>
                </div>
                <!-- 引用消息显示区域 -->
                <div id="quote-preview" style="display: none; padding: 8px 16px; background: rgba(0,0,0,0.05); border-left: 3px solid #6c5ce7; margin: 0 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 12px; color: #6c5ce7; font-weight: 500;">回复 <span id="quote-user"></span></div>
                            <div id="quote-content" style="font-size: 13px; color: #666; margin-top: 2px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
                        </div>
                        <button id="cancel-quote" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0 8px;">×</button>
                    </div>
                </div>
                <!-- 普通输入区域 (非机器人聊天) -->
                <div class="input-area" id="input-area">
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                    <button class="image-btn" onclick="document.getElementById('image-input').click()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </button>
                    <button class="image-btn" id="voice-btn" title="语音消息">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <input type="text" id="message-input" placeholder="输入消息...">
                    <button class="send-btn" id="send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
                <!-- 语音录制界面 -->
                <div class="voice-recorder" id="voice-recorder">
                    <div class="recording-indicator">
                        <div class="recording-dot"></div>
                        <div class="recording-time" id="recording-time">00:00</div>
                        <span style="color: white; font-size: 14px;">正在录制...</span>
                    </div>
                    <div class="recording-actions">
                        <button class="cancel-recording-btn" id="cancel-recording-btn">❌ 取消</button>
                        <button class="stop-recording-btn" id="stop-recording-btn">⏹ 完成录制</button>
                    </div>
                </div>
                <!-- 语音预览界面 -->
                <div class="voice-preview" id="voice-preview">
                    <div class="voice-waveform">
                        <button class="play-voice-btn" id="play-preview-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </button>
                        <div class="voice-duration" id="preview-duration">00:00</div>
                    </div>
                    <div class="voice-preview-actions">
                        <button class="rerecord-btn" id="rerecord-btn">🔄 重新录制</button>
                        <button class="send-voice-btn" id="send-voice-btn">📤 发送</button>
                    </div>
                </div>
                <!-- 机器人输入区域 (仅对怡总显示) -->
                <div id="bot-input-area" style="display: none; padding: 16px; background: #f9f9f9; border-top: 2px solid #e0e0e0;">
                    <!-- 上方：输入区域 -->
                    <div style="display: flex; gap: 16px; height: 200px; margin-bottom: 16px;">
                        <!-- 左侧：文本输入区域 -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="font-size: 13px; font-weight: 500; color: #666; margin-bottom: 8px;">📋 粘贴或输入聊天记录</div>
                            <textarea
                                id="bot-text-input"
                                placeholder="在这里粘贴或输入聊天记录...&#10;&#10;例如：&#10;张三 10:30&#10;大家好，今天讨论项目进度&#10;&#10;李四 10:32&#10;项目进展顺利..."
                                style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Courier New', monospace; resize: none; line-height: 1.5;"
                            ></textarea>
                        </div>
                        <!-- 右侧：PDF上传区域 -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="font-size: 13px; font-weight: 500; color: #666; margin-bottom: 8px;">📄 上传PDF文件</div>
                            <div id="bot-pdf-drop-zone" style="flex: 1; border: 2px dashed #6c5ce7; border-radius: 8px; padding: 20px; text-align: center; background: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <input type="file" id="bot-pdf-input" accept=".pdf" style="display: none;">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2" style="margin-bottom: 12px;">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 4px;">拖拽PDF文件到这里</div>
                                <div style="font-size: 12px; color: #999;">或点击选择文件 (最大10MB)</div>
                            </div>
                            <div id="bot-pdf-file-info" style="display: none; flex: 1; padding: 10px; background: white; border: 2px solid #6c5ce7; border-radius: 8px; font-size: 13px;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="flex: 1; overflow: hidden;">
                                        <div id="bot-pdf-file-name" style="font-weight: 500; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                                        <div id="bot-pdf-file-size" style="font-size: 11px; color: #999; margin-top: 2px;"></div>
                                    </div>
                                    <button id="bot-remove-pdf-btn" style="background: none; border: none; font-size: 18px; color: #999; cursor: pointer; margin-left: 8px;">×</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 总结按钮 -->
                    <button id="bot-submit-btn" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #6c5ce7 0%, #5f27cd 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-bottom: 16px;">📊 开始总结</button>
                    <!-- 下方：总结结果展示区域 -->
                    <div id="bot-result-area" style="display: none; padding: 20px; background: white; border-radius: 8px; border-left: 4px solid #6c5ce7; min-height: 200px;">
                        <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 12px;">📊 总结结果</div>
                        <div id="bot-result-content" style="font-size: 14px; line-height: 1.8; color: #555; white-space: pre-wrap;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建群组弹窗 -->
    <div class="modal" id="create-group-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>创建群聊</h3>
                <button class="close-btn" id="close-modal-btn">&times;</button>
            </div>
            <input type="text" class="modal-input" id="group-name-input" placeholder="输入群名称（最多20个字符）" maxlength="20">
            <div class="member-list" id="member-list">
                <!-- 成员列表将动态加载 -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancel-group-btn">取消</button>
                <button class="modal-btn primary" id="confirm-group-btn">创建</button>
            </div>
        </div>
    </div>

    <!-- 阅读详情弹窗 -->
    <div class="modal" id="read-detail-modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>阅读状态</h3>
                <button class="close-btn" id="close-read-detail-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">已读 (<span id="read-count">0</span>)</div>
                <div id="read-list" style="max-height: 150px; overflow-y: auto; margin-bottom: 16px;">
                    <!-- 已读成员列表 -->
                </div>
                <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">未读 (<span id="unread-count">0</span>)</div>
                <div id="unread-list" style="max-height: 150px; overflow-y: auto;">
                    <!-- 未读成员列表 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 机器人Prompt设置弹窗 -->
    <div class="modal" id="bot-settings-modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>⚙️ 设置总结Prompt</h3>
                <button class="close-btn" id="close-bot-settings-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                    自定义Prompt：
                </label>
                <textarea
                    id="bot-prompt-input"
                    placeholder="例如：请用3个要点总结会议内容，突出行动项和责任人"
                    style="width: 100%; height: 150px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical;"
                ></textarea>
                <div style="margin-top: 12px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 13px; color: #666;">
                    💡 <strong>提示：</strong>这个Prompt将用于总结你发送的聊天记录。你可以根据需要自定义总结的格式和重点。
                </div>
                <div style="margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-bot-settings-btn" style="padding: 10px 20px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">取消</button>
                    <button id="save-bot-settings-btn" style="padding: 10px 20px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 聊天记录粘贴/PDF上传弹窗 -->
    <div class="modal" id="bot-upload-modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>📋 提交聊天记录</h3>
                <button class="close-btn" id="close-bot-upload-btn">&times;</button>
            </div>
            <div style="margin-top: 16px;">
                <!-- Tab切换 -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button id="paste-tab" class="upload-tab active" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid #6c5ce7; color: #6c5ce7; font-size: 15px; font-weight: 500; cursor: pointer;">粘贴文本</button>
                    <button id="upload-tab" class="upload-tab" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid transparent; color: #999; font-size: 15px; font-weight: 500; cursor: pointer;">上传PDF</button>
                </div>

                <!-- 粘贴文本区域 -->
                <div id="paste-content" style="display: block;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        粘贴聊天记录：
                    </label>
                    <textarea
                        id="chat-record-input"
                        placeholder="将聊天记录粘贴到这里...&#10;&#10;例如：&#10;张三 10:30&#10;大家好，今天我们讨论项目进度&#10;&#10;李四 10:32&#10;项目目前进展顺利..."
                        style="width: 100%; height: 300px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Courier New', monospace; resize: vertical; line-height: 1.5;"
                    ></textarea>
                    <div style="margin-top: 12px; padding: 12px; background: #f0f7ff; border-left: 4px solid #6c5ce7; border-radius: 4px; font-size: 13px; color: #555;">
                        💡 <strong>提示：</strong>直接粘贴聊天记录文本，怡总会根据你设置的Prompt进行总结分析。
                    </div>
                </div>

                <!-- 上传PDF区域 -->
                <div id="upload-content" style="display: none;">
                    <div style="border: 2px dashed #6c5ce7; border-radius: 12px; padding: 40px; text-align: center; background: #f9f9ff; cursor: pointer;" id="pdf-drop-zone">
                        <input type="file" id="pdf-input" accept=".pdf" style="display: none;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2" style="margin: 0 auto 16px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        <div style="font-size: 16px; font-weight: 500; color: #333; margin-bottom: 8px;">点击或拖拽PDF文件到这里</div>
                        <div style="font-size: 13px; color: #999;">支持PDF格式，最大10MB</div>
                    </div>
                    <div id="pdf-file-info" style="display: none; margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 14px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6c5ce7" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <div style="flex: 1;">
                                <div id="pdf-file-name" style="font-weight: 500; color: #333;"></div>
                                <div id="pdf-file-size" style="font-size: 12px; color: #999; margin-top: 2px;"></div>
                            </div>
                            <button id="remove-pdf-btn" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer;">×</button>
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px; font-size: 13px; color: #856404;">
                        ⚠️ <strong>注意：</strong>PDF文本提取功能需要服务器端支持，当前版本会提取PDF中的文本内容进行分析。
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-bot-upload-btn" style="padding: 10px 24px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">取消</button>
                    <button id="submit-bot-upload-btn" style="padding: 10px 24px; background: #6c5ce7; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">📤 提交总结</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI聊天总结对话框 -->
    <div class="modal" id="ai-summary-modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>🤖 AI聊天总结</h3>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button id="config-summary-prompt-btn" style="padding: 6px 12px; background: #6c5ce7; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">⚙️ 配置Prompt</button>
                    <button class="close-btn" id="close-ai-summary-btn">&times;</button>
                </div>
            </div>
            <div style="margin-top: 16px;">
                <!-- Prompt配置区域（默认隐藏） -->
                <div id="summary-prompt-config" style="display: none; margin-bottom: 20px; padding: 12px; background: #f9f9ff; border: 2px solid #6c5ce7; border-radius: 8px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px;">
                        总结Prompt：
                    </label>
                    <textarea id="summary-prompt-input" placeholder="请输入你希望AI如何总结聊天记录的提示词..." style="width: 100%; height: 150px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 13px; font-family: 'Courier New', monospace; resize: vertical; line-height: 1.5;"></textarea>
                    <div style="margin-top: 8px; font-size: 12px; color: #666;">
                        💡 提示：留空则使用默认的多维度分析提示词
                    </div>
                </div>

                <!-- 用户选择 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        选择用户：
                    </label>
                    <div id="user-select-container" style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 12px; max-height: 200px; overflow-y: auto; background: #fafafa;">
                        <!-- 用户复选框列表将动态生成 -->
                    </div>
                </div>

                <!-- 时间段选择 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        时间段：
                    </label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="date" id="summary-start-date" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        <span style="color: #999;">至</span>
                        <input type="date" id="summary-end-date" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancel-ai-summary-btn" style="padding: 10px 24px; background: #e0e0e0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">取消</button>
                    <button id="submit-ai-summary-btn" style="padding: 10px 24px; background: #07c160; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">📊 开始总结</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI总结结果抽屉 -->
    <div id="ai-summary-drawer" style="display: none; position: fixed; right: 0; top: 0; width: 500px; height: 100vh; background: white; box-shadow: -4px 0 24px rgba(0,0,0,0.15); z-index: 10000; overflow-y: auto;">
        <div style="padding: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 16px;">
                <h3 style="font-size: 20px; color: #333;">📊 AI聊天总结结果</h3>
                <button id="close-drawer-btn" style="background: none; border: none; font-size: 28px; color: #999; cursor: pointer; line-height: 1;">&times;</button>
            </div>

            <!-- 总结信息 -->
            <div id="summary-info" style="margin-bottom: 20px; padding: 12px; background: #f0f7ff; border-left: 4px solid #07c160; border-radius: 4px;">
                <div style="font-size: 13px; color: #666; line-height: 1.6;">
                    <div><strong>用户：</strong><span id="summary-users-info"></span></div>
                    <div><strong>时间段：</strong><span id="summary-time-info"></span></div>
                    <div><strong>消息数量：</strong><span id="summary-count-info"></span></div>
                </div>
            </div>

            <!-- 加载状态 -->
            <div id="summary-loading" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 16px;">⏳</div>
                <div style="font-size: 16px; color: #666;">AI正在分析聊天记录...</div>
            </div>

            <!-- 总结内容 -->
            <div id="summary-result-content" style="font-size: 14px; line-height: 1.8; color: #333; white-space: pre-wrap;"></div>
        </div>
    </div>

    <!-- 抽屉遮罩层 -->
    <div id="drawer-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;"></div>

    <script src="app.js"></script>
</body>
</html>
