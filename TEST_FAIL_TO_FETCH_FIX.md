# "Fail to Fetch" 修复测试指南

**测试目的**: 验证AI总结bot不再出现 "fail to fetch" 错误

---

## 🎯 快速测试步骤

### 1. 启动服务器
```bash
python3 server.py
```

### 2. 打开浏览器
访问 `http://localhost:8080`

---

## 📋 测试场景

### ✅ 场景1: 短文本总结（应该成功）

**测试内容**:
1. 点击"亿总"按钮
2. 粘贴短文本（约500-1000字）
3. 点击"开始总结"

**预期结果**:
- ✅ 显示"正在处理中，这可能需要1-2分钟..."
- ✅ 10-20秒内返回总结结果
- ✅ 无错误

---

### ✅ 场景2: 中等文本总结（应该成功）

**测试内容**:
1. 使用"AI聊天总结"功能
2. 选择包含100-200条消息的聊天记录
3. 点击"开始总结"

**预期结果**:
- ✅ 显示"正在AI总结中，请稍候..."
- ✅ 20-40秒内返回总结结果
- ✅ 无错误

---

### ⚠️ 场景3: 超长文本（测试后端超时）

**测试内容**:
1. 准备超长文本（约20000-30000字）
2. 使用亿总功能
3. 粘贴并开始总结

**预期结果**:
- ✅ 显示处理中提示
- ⏱️ 约30秒后后端超时
- ✅ 显示清晰错误：**"错误：API调用超时"**
- ❌ **不应该**显示 "fail to fetch"

---

### ⏱️ 场景4: 极长文本（测试前端超时）

**测试内容**:
1. 准备极长文本（约50000字以上）
2. 使用AI聊天总结
3. 开始总结

**预期结果**:
- ✅ 显示处理中提示
- ⏱️ 约60秒后前端超时
- ✅ 显示清晰错误：**"⏱️ 请求超时：处理时间过长（超过60秒），请尝试减少聊天记录或稍后再试"**
- ❌ **不应该**显示 "fail to fetch"

---

### 🔌 场景5: 服务器未运行（测试连接失败）

**测试内容**:
1. 停止服务器（Ctrl+C）
2. 在浏览器中尝试使用AI总结

**预期结果**:
- ✅ 立即显示错误
- ✅ **"❌ 连接失败：无法连接到服务器，请检查服务器是否运行"**
- ❌ **不应该**显示 "fail to fetch"

---

## 🎯 验证要点

在测试过程中，重点验证以下几点：

### ✅ 不再出现 "fail to fetch"
- [ ] 任何场景下都不应该看到模糊的 "Failed to fetch" 或 "fail to fetch"
- [ ] 所有错误都有清晰的中文描述

### ✅ 错误消息清晰
- [ ] 超时错误：显示"请求超时"并给出建议
- [ ] 连接失败：显示"连接失败"并提示检查服务器
- [ ] API错误：显示具体的错误信息

### ✅ 有处理中提示
- [ ] 亿总：显示"正在处理中，这可能需要1-2分钟..."
- [ ] AI聊天总结：显示"正在AI总结中，请稍候..."

### ✅ 超时时间合理
- [ ] 正常文本（< 10000字）能在30秒内完成
- [ ] 后端超时在30秒左右
- [ ] 前端超时在60-90秒（根据功能不同）

---

## 📊 测试结果记录

### 场景1: 短文本总结
- [ ] 通过
- [ ] 失败：________________

### 场景2: 中等文本总结
- [ ] 通过
- [ ] 失败：________________

### 场景3: 超长文本（后端超时）
- [ ] 通过（显示"API调用超时"）
- [ ] 失败：________________

### 场景4: 极长文本（前端超时）
- [ ] 通过（显示"请求超时..."）
- [ ] 失败：________________

### 场景5: 服务器未运行
- [ ] 通过（显示"连接失败..."）
- [ ] 失败：________________

---

## 🐛 如果仍然出现问题

### 如果看到 "fail to fetch"
1. 检查浏览器控制台（F12）
2. 查看完整错误信息
3. 报告具体场景和错误详情

### 如果超时设置不合理
- 太短（正常内容也超时）→ 增加前端超时时间
- 太长（等待时间太久）→ 减少前端超时时间

### 修改超时时间

**前端超时** (`app.js`):
```javascript
// 亿总功能 (行1950)
const timeoutId = setTimeout(() => controller.abort(), 90000); // 改这里

// AI聊天总结 (行2152)
const timeoutId = setTimeout(() => controller.abort(), 60000); // 改这里
```

**后端超时** (`server.py` 行495):
```python
timeout=aiohttp.ClientTimeout(total=30)  # 改这里
```

---

## ✅ 测试通过标准

测试通过需要满足：

1. ✅ **核心功能正常** - 短文本、中等文本能正常总结
2. ✅ **不再出现"fail to fetch"** - 任何场景都显示清晰错误
3. ✅ **错误消息有用** - 能指导用户如何处理
4. ✅ **有进度提示** - 用户知道系统在工作

---

## 📝 测试小贴士

### 生成测试文本

**短文本（1000字）**:
```
复制任意文章段落，约2-3段
```

**中等文本（5000字）**:
```
复制聊天记录或文章，约10-20段
```

**超长文本（20000字）**:
```
复制长文章或多个聊天记录拼接
```

**极长文本（50000字）**:
```
复制超长文档或大量聊天记录
```

### 快速测试命令

```bash
# 检查修复是否生效
grep -n "AbortController" app.js | head -5
# 应该看到行1949和行2151附近的代码

# 检查后端超时
grep -n "ClientTimeout(total=" server.py
# 应该看到 total=30
```

---

**祝测试顺利！** 🎉
